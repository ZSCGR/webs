import{u as y,a as _,b as c,d as s,n as m,t as n,i as h,w as k,x as g,F as b,k as p,o as i,f}from"./vendor-Dww-ccMT.js";import{_ as v}from"./index-cTDpMoY0.js";const w={name:"MTRtest",setup(){const r=y(),l=_(()=>r.state.isDarkMode),o=_(()=>r.state.isMobile);let t=_(()=>r.state.Global_ipDataCards.filter(d=>d&&!d.includes(" ")&&!d.includes(":")));return{isDarkMode:l,isMobile:o,allIPs:t}},data(){return{selectedIP:"",mtrResults:{},mtrCheckStatus:"idle"}},methods:{startmtrCheck(){this.$trackEvent("Section","StartClick","MTRTest"),this.mtrResults=[];let r=0;const l=async()=>{this.mtrCheckStatus="running";try{const t=await fetch("https://api.globalping.io/v1/measurements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({limit:16,locations:[{country:"HK"},{country:"TW"},{country:"CN"},{country:"JP"},{country:"SG"},{country:"IN"},{country:"RU"},{country:"US"},{country:"CA"},{country:"AU"},{country:"GB"},{country:"DE"},{country:"FR"},{country:"BR"},{country:"ZA"},{country:"SA"}],target:this.selectedIP,type:"mtr",measurementOptions:{port:80,protocol:"ICMP"}})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){console.error("Error sending mtr request:",t)}},o=async t=>{try{const e=await fetch(`https://api.globalping.io/v1/measurements/${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const d=await e.json();this.processmtrResults(d),d.status==="in-progress"&&r<4?(setTimeout(()=>o(t),1e3),r++):this.mtrResults.length===0?this.mtrCheckStatus="error":this.mtrCheckStatus="finished"}catch(e){console.error("Error fetching mtr results:",e)}};l().then(t=>{t&&t.id&&setTimeout(()=>{o(t.id)},1e3)})},processmtrResults(r){const l=r.results.filter(o=>o.result.status==="finished").filter(o=>o.result.rawOutput!==null).map(o=>({country:o.probe.country,city:o.probe.city,network:o.probe.network,asn:o.probe.asn,rawOutput:o.result.rawOutput}));this.mtrResults=l}}},C={class:"mtr-test-section mb-4"},S={class:"jn-title2"},M={class:"text-secondary"},R={key:0},P={class:"row"},T={class:"col-12 mb-3"},I={class:"card-body"},D={class:"row mt-3 mb-3 align-items-center justify-content-center"},N={class:"col-12 col-md-auto"},j={for:"mtrIP",class:"col-form-label"},E={class:"col-12 col-md-auto mt-2 mt-md-0"},O={class:"input-group"},A={disabled:"",value:""},B=["value"],U=["disabled"],V={key:0},F={key:1,class:"spinner-grow spinner-grow-sm","aria-hidden":"true"},G={key:0,id:"mtrresult"},H=["data-bs-theme"],q=["id"],J=["data-bs-target","aria-expanded","aria-controls"],L={key:0},z=["id","aria-labelledby"],K={class:"accordion-body"},W={key:1,id:"mtrresult-error"},Z=["data-bs-theme"];function Q(r,l,o,t,e,d){return i(),c("div",C,[s("div",S,[s("h2",{id:"MTRTest",class:m({"mobile-h2":t.isMobile})},"ðŸ“¡ "+n(r.$t("mtrtest.Title")),3)]),s("div",M,[s("p",null,n(r.$t("mtrtest.Note")),1),t.isMobile?h("",!0):(i(),c("p",R,n(r.$t("mtrtest.Note2")),1))]),s("div",P,[s("div",T,[s("div",{class:m(["card jn-card",{"dark-mode dark-mode-border":t.isDarkMode}])},[s("div",I,[s("div",D,[s("div",N,[s("label",j,n(r.$t("mtrtest.Note3")),1)]),s("div",E,[s("div",O,[k(s("select",{id:"mtrIP",class:m(["form-select jn-ping-form-select",{"bg-dark text-light":t.isDarkMode}]),"onUpdate:modelValue":l[0]||(l[0]=a=>e.selectedIP=a)},[s("option",A,n(r.$t("mtrtest.SelectIP")),1),(i(!0),c(b,null,p(t.allIPs,a=>(i(),c("option",{key:a,value:a},n(a),9,B))),128))],2),[[g,e.selectedIP]]),s("button",{class:"btn btn-primary",onClick:l[1]||(l[1]=(...a)=>d.startmtrCheck&&d.startmtrCheck(...a)),disabled:e.mtrCheckStatus==="running"||e.selectedIP===""},[e.mtrCheckStatus==="idle"||e.mtrCheckStatus==="finished"||e.mtrCheckStatus==="error"?(i(),c("span",V,n(r.$t("mtrtest.Run")),1)):h("",!0),e.mtrCheckStatus==="running"?(i(),c("span",F)):h("",!0)],8,U)])])]),e.mtrResults.length>0?(i(),c("div",G,[s("div",{class:"accordion",id:"mtrResultsAccordion","data-bs-theme":t.isDarkMode?"dark":""},[(i(!0),c(b,null,p(e.mtrResults,(a,u)=>(i(),c("div",{class:"accordion-item",key:a.country},[s("h2",{class:"accordion-header",id:"heading"+u},[s("button",{class:m(["accordion-button",{collapsed:u!==0}]),type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+u,"aria-expanded":u===0?"true":"false","aria-controls":"collapse"+u},[s("span",{class:m("jn-fl fi fi-"+a.country.toLowerCase())},null,2),f("Â "),s("strong",null,n(a.city)+", "+n(a.country),1),t.isMobile?h("",!0):(i(),c("span",L,"Â -Â "+n(a.network)+"Â ",1)),t.isMobile?h("",!0):(i(),c("span",{key:1,class:m(["badge rounded-pill",t.isDarkMode?"text-bg-warning":"text-bg-success"])},"AS"+n(a.asn),3))],10,J)],8,q),s("div",{id:"collapse"+u,class:m(["accordion-collapse collapse",{show:u===0}]),"aria-labelledby":"heading"+u},[s("div",K,[s("div",{class:m(["card card-body border-0 mt-3",[t.isDarkMode?"bg-black text-light":"bg-light"]])},[s("pre",null,n(a.rawOutput),1)],2)])],10,z)]))),128))],8,H)])):h("",!0),e.mtrCheckStatus==="error"?(i(),c("div",W,[s("div",{class:"alert alert-info","data-bs-theme":t.isDarkMode?"dark":""},n(r.$t("mtrtest.Error")),9,Z)])):h("",!0)])],2)])])])}const x=v(w,[["render",Q],["__scopeId","data-v-df893ce9"]]);export{x as default};
