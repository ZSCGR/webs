import{u as _,a as g,Q as k,b as l,d as t,n as p,t as e,i as h,w as y,x as v,F as u,k as m,o as c,f}from"./vendor-Dww-ccMT.js";import{_ as P}from"./index-cTDpMoY0.js";const b={name:"GlobalLatency",setup(){const s=_(),i=g(()=>s.state.isDarkMode),r=g(()=>s.state.isMobile);let o=g(()=>s.state.Global_ipDataCards.filter(d=>d&&!d.includes(" ")&&!d.includes(":")));return{isDarkMode:i,isMobile:r,allIPs:o}},data(){return{selectedIP:"",pingResults:{},pingCheckStatus:"idle"}},methods:{startPingCheck(){this.$trackEvent("Section","StartClick","GlobalLatency"),this.pingResults=[];let s=0;const i=async()=>{this.pingCheckStatus="running";try{const o=await fetch("https://api.globalping.io/v1/measurements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({limit:16,locations:[{country:"HK"},{country:"TW"},{country:"CN"},{country:"JP"},{country:"SG"},{country:"IN"},{country:"RU"},{country:"US"},{country:"CA"},{country:"AU"},{country:"GB"},{country:"DE"},{country:"FR"},{country:"BR"},{country:"ZA"},{country:"SA"}],target:this.selectedIP,type:"ping",measurementOptions:{packets:8}})});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){console.error("Error sending ping request:",o)}},r=async o=>{try{const a=await fetch(`https://api.globalping.io/v1/measurements/${o}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const d=await a.json();this.processPingResults(d),d.status==="in-progress"&&s<4?(setTimeout(()=>r(o),1e3),s++):this.pingResults.length===0?this.pingCheckStatus="error":(this.pingCheckStatus="finished",this.drawMap())}catch(a){console.error("Error fetching ping results:",a)}};i().then(o=>{o&&o.id&&setTimeout(()=>{r(o.id)},1e3)})},processPingResults(s){const i=s.results.filter(r=>r.result.status==="finished").filter(r=>r.result.stats.min!==null).map(r=>({country:r.probe.country,stats:r.result.stats}));this.pingResults=i},drawMap(){const s={data:{avgPing:{name:this.$t("pingtest.AvgDelay"),format:"{0} ms",thresholdMax:250,thresholdMin:0},minPing:{name:this.$t("pingtest.MinDelay"),format:"{0} ms"},maxPing:{name:this.$t("pingtest.MaxDelay"),format:"{0} ms"},total:{name:this.$t("pingtest.TotalPackets"),format:"{0}"},loss:{name:this.$t("pingtest.PacketLoss"),format:"{0}%"},rcv:{name:this.$t("pingtest.ReceivedPackets"),format:"{0}"},drop:{name:this.$t("pingtest.DroppedPackets"),format:"{0}"}},applyData:"avgPing",values:{}};this.pingResults.forEach(i=>{s.values[i.country]={avgPing:i.stats.avg,minPing:i.stats.min,maxPing:i.stats.max,total:i.stats.total,loss:i.stats.loss,rcv:i.stats.rcv,drop:i.stats.drop}}),new k({targetElementID:"svgMap",data:s,colorMax:"#083923",colorMin:"#22CB80",minZoom:1,maxZoom:1,mouseWheelZoomEnabled:!1,initialZoom:1})}}},M={class:"ping-test-section mb-4"},C={class:"jn-title2"},S={class:"text-secondary"},w={key:0},R={class:"row"},D={class:"col-12 mb-3"},I={class:"card-body"},T={class:"row mt-3 mb-3 align-items-center justify-content-center"},E={class:"col-12 col-md-auto"},$={for:"pingIP",class:"col-form-label"},x={class:"col-12 col-md-auto mt-2 mt-md-0"},N={class:"input-group"},j={disabled:"",value:""},A=["value"],B=["disabled"],F={key:0},L={key:1,class:"spinner-grow spinner-grow-sm","aria-hidden":"true"},G={key:0,id:"pingresult"},Z={class:"table-responsive text-nowrap"},U={scope:"col"},V={scope:"col"},H={scope:"col"},O={scope:"col"},q={scope:"col"},J={scope:"col"},W={scope:"col"},z={scope:"col"},K=t("div",{id:"svgMap"},null,-1),Q={key:1,id:"pingresult-error"},X=["data-bs-theme"];function Y(s,i,r,o,a,d){return c(),l("div",M,[t("div",C,[t("h2",{id:"PingTest",class:p({"mobile-h2":o.isMobile})},"🌐 "+e(s.$t("pingtest.Title")),3)]),t("div",S,[t("p",null,e(s.$t("pingtest.Note")),1),o.isMobile?h("",!0):(c(),l("p",w,e(s.$t("pingtest.Note2")),1))]),t("div",R,[t("div",D,[t("div",{class:p(["card jn-card",{"dark-mode dark-mode-border":o.isDarkMode}])},[t("div",I,[t("div",T,[t("div",E,[t("label",$,e(s.$t("pingtest.Note3")),1)]),t("div",x,[t("div",N,[y(t("select",{id:"pingIP",class:p(["form-select jn-ping-form-select",{"bg-dark text-light":o.isDarkMode}]),"onUpdate:modelValue":i[0]||(i[0]=n=>a.selectedIP=n)},[t("option",j,e(s.$t("pingtest.SelectIP")),1),(c(!0),l(u,null,m(o.allIPs,n=>(c(),l("option",{key:n,value:n},e(n),9,A))),128))],2),[[v,a.selectedIP]]),t("button",{class:"btn btn-primary",onClick:i[1]||(i[1]=(...n)=>d.startPingCheck&&d.startPingCheck(...n)),disabled:a.pingCheckStatus==="running"||a.selectedIP===""},[a.pingCheckStatus==="idle"||a.pingCheckStatus==="finished"||a.pingCheckStatus==="error"?(c(),l("span",F,e(s.$t("pingtest.Run")),1)):h("",!0),a.pingCheckStatus==="running"?(c(),l("span",L)):h("",!0)],8,B)])])]),a.pingResults.length>0?(c(),l("div",G,[t("div",Z,[t("table",{class:p(["table table-hover",{"table-dark":o.isDarkMode}])},[t("thead",null,[t("tr",null,[t("th",U,e(s.$t("pingtest.Region")),1),t("th",V,e(s.$t("pingtest.MinDelay")),1),t("th",H,e(s.$t("pingtest.MaxDelay")),1),t("th",O,e(s.$t("pingtest.AvgDelay")),1),t("th",q,e(s.$t("pingtest.TotalPackets")),1),t("th",J,e(s.$t("pingtest.PacketLoss")),1),t("th",W,e(s.$t("pingtest.ReceivedPackets")),1),t("th",z,e(s.$t("pingtest.DroppedPackets")),1)])]),t("tbody",null,[(c(!0),l(u,null,m(a.pingResults,n=>(c(),l("tr",{key:n.country},[t("td",null,[t("span",{class:p("jn-fl fi fi-"+n.country.toLowerCase())},null,2),f(" "+e(n.country),1)]),t("td",{class:p(n.stats.min<100?"text-success":"")},e(n.stats.min.toFixed(1)),3),t("td",{class:p(n.stats.max<100?"text-success":"")},e(n.stats.max.toFixed(1)),3),t("td",{class:p(n.stats.avg<100?"text-success":"")},e(n.stats.avg.toFixed(1)),3),t("td",null,e(n.stats.total),1),t("td",null,e(Math.round(n.stats.loss))+"%",1),t("td",null,e(n.stats.rcv),1),t("td",null,e(n.stats.drop),1)]))),128))])],2)])])):h("",!0),K,a.pingCheckStatus==="error"?(c(),l("div",Q,[t("div",{class:"alert alert-info","data-bs-theme":o.isDarkMode?"dark":""},e(s.$t("pingtest.Error")),9,X)])):h("",!0)])],2)])])])}const et=P(b,[["render",Y]]);export{et as default};
