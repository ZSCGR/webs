define("./index-cc63e70b.js",["exports","./chunk-539de822","./chunk-4fc10aa5","./chunk-a647c4b1","./chunk-9e0cea02"],function(e,t,n,i,r){"use strict";var a=function(){function e(e,t,n){this._numTilesX=e,this._numTilesY=t,this._renderer=n,this._renderLoopRunning=!1,this._changeBuffer=[],this._lastTs=r.getTime(),r.unfreeze(),this._initCellDetails(),this._startRenderLoop()}return Object.defineProperty(e.prototype,"numTiles",{get:function(){return this._numTilesX*this._numTilesY},enumerable:!0,configurable:!0}),e.prototype.updateCells=function(e){var n;(n=this._changeBuffer).push.apply(n,t.__spread(e))},e.prototype.stop=function(){this._renderLoopRunning=!1},e.prototype._initCellDetails=function(){var e=r.getTime(),t=i.rippleSpeed*Math.max(this._numTilesX,this._numTilesY);this._cellDetails=new Array(this.numTiles);for(var n=0;n<this._numTilesY;n++)for(var a=0;a<this._numTilesX;a++)this._cellDetails[n*this._numTilesX+a]={animationList:[{name:0,start:e-t+s(a,n,this._numTilesX,this._numTilesY)*t}],hasFlashed:!1,x:a,y:n}},e.prototype._updateAnimation=function(e){var t=e.cell,n=e.animationList,a=r.getTime();if(t){if(t.revealed||t.flagged){if(!t.revealed&&t.flagged)n[0].name=6,n[0].fadeStart=a,n.push({name:3,start:a});else if(t.revealed){var s=n.some(function(e){return 3===e.name});if(t.touchingFlags>=t.touchingMines&&t.touchingMines>0&&!s?n.push({name:3,start:a}):t.touchingFlags<t.touchingMines&&s&&(n=i.removeAnimations(n,[3,4])).push({name:4,start:a}),e.animationList=n,e.hasFlashed)return;n=i.removeAnimations(n,[0]),e.hasFlashed=!0,n.push({name:1,start:a,done:function(){n=e.animationList,n=i.removeAnimations(n,[1]),e.animationList=n}}),t.hasMine?n.push({name:7,start:a+100}):n.unshift({name:5,start:a+100}),n.push({name:2,start:a+100})}}else n[0].name=0,n[0].fadeStart=a,(n=i.removeAnimations(n,[3,4])).push({name:4,start:a,done:function(){n=e.animationList,n=i.removeAnimations(n,[3,4]),e.animationList=n}});e.animationList=n}else console.warn("Unknown cell")},e.prototype._animateTile=function(e,n){var i,r;try{for(var a=t.__values(e.animationList),s=a.next();!s.done;s=a.next()){var o=s.value;this._renderer.render(e.x,e.y,e.cell,o,n)}}catch(e){i={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}},e.prototype._startRenderLoop=function(){this._renderLoopRunning||(this._renderLoopRunning=!0,requestAnimationFrame(this._renderLoop))},e.prototype._consumeChangeBuffer=function(e){var n,i,r=Math.floor(5*e/16),a=this._changeBuffer.splice(0,r);try{for(var s=t.__values(a),o=s.next();!o.done;o=s.next()){var l=t.__read(o.value,3),u=l[0],h=l[1],m=l[2],f=this._cellDetails[h*this._numTilesX+u];f.cell=m,this._updateAnimation(f)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},e.prototype._renderLoop=function(){var e,n,i=r.getTime(),a=i-this._lastTs;this._lastTs=i,this._consumeChangeBuffer(a),this._renderer.beforeUpdate();try{for(var s=t.__values(this._cellDetails),o=s.next();!o.done;o=s.next()){var l=o.value;this._renderer.beforeCell(l.x,l.y,l.cell,l.animationList,i),this._animateTile(l,i),this._renderer.afterCell(l.x,l.y,l.cell,l.animationList,i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}this._renderer.afterUpdate(),this._renderLoopRunning&&requestAnimationFrame(this._renderLoop)},t.__decorate([n.bind],e.prototype,"_renderLoop",null),e}();function s(e,t,n,i){var r=n/2,a=i/2,s=e+.5-r,o=t+.5-a;return Math.sqrt(s*s+o*o)/Math.sqrt(r*r+a*a)}e.default=a});
//# sourceMappingURL=index-cc63e70b.js.map
